<!DOCTYPE html> 

<html> 

    <head> 

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>albus_owl29 Blog</title> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
        <meta name="HandheldFriendly" content="true">
        <meta name="MobileOptimized" content="width">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="author" content="Albert Kramar">
        <meta name="copyright" content="all rights belong to Albert Kramar"> 
        <meta name="description" content="Блог Android-разработчика albus_owl29">
        <meta name="robots" content="index,follow"/>
        <link rel="icon" href="../../img/favicon.ico" type="image/x-icon">
        <link rel="stylesheet" href="../../css/main.css" type="text/css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet"> 
        <style type="text/css"> main h2 {color: red;} main h3 {color: blue;} main h4 {color: green;} main h2,h3,h4 {margin: 0 2% 2% 2%; padding-top: 2%;} </style>

    </head> 

    <body> 

         <header class="page-header">

                <h2>Mobile sound — it's easy</h2>

        </header>

        <div class="container">

            <nav class="nav">
               
                <ul>
                    <li><a href="../../index.html">Главная</a></li>
                     <li class="dropdown">
                        <a class="active" href="javascript:void(0)" class="dropbtn">Статьи</a>
                            <div class="dropdown-content">
                                <a href="articles.html">Лента</a>
                                <a href="tree.html">Дерево</a>
                            </div>
                    <li><a href="../guides/guides.html">Гайды</a></li>
                    <li><a href="../about.html">О сайте</a></li>
                </ul>

            </nav>

            <main class="content">
                
                <div class="article_tree_other">
                    
                    <p>Дерево статей</p>

                </div>

                <section class="article">

                    <h2>Аудиомодификации для Android-смартфонов</h2>
                    <p></p>

                    <p>Предыдущая статья была посвящена теме качества мобильного звука в Android-смартфонах. Углубляясь в эту тему мы подробно рассмотрим что из себя представляют аудиомодификации, требования для их установки, принципы работы magisk модуля и способы улучшения качества звука на примере "NLSound". После установки модификации проведём анализ работы устройства и качества звука.</p>

                    <p><h3>Magisk и аудиомоды</h3></p>

                    <p>Итак, приступим. Для установки аудиомодификации нам понадобится Magisk - метод получения Root доступа на устройстве, а также, средство внесения изменений в Android без изменения самой системы, т.е. внесистемно. Установка Magisk в систему — это и есть получение Root прав. Возможность получать Root есть на смартфонах, где загрузчик разблокирован, т.к. на заблокированном загрузчике легко получить "кирпич". Методы разблокировки загрузчика обсуждаются в соответствующей теме на 4пда. При прошивке Magisk в систему устанавливается приложениие MagiskManager, через которое мы будем производить все необходимые действия. Заходим в него и переходим в "Модули". Выбираем скачанный модуль NLSound (в нашем случае версия 3.2 STABLE Qualcomm) и приступаем к установке. Устанавливая модуль в magisk получить "кирпич" невозможно, т.к. для отмены изменений, при том же бутлупе, достаточно через TWRP удалить папку с модулем по пути /data/adb/modules/название модуля. Также, стоит отметить, что аудиомоды имеет смысл ставить только на смартфоны, имеющие чипы от данных компаний: Qualcomm и MediaTek. Android-смартфоны на базе этих процессоров имеют самое широкое распространение, соответственно, самое большое сообщество мододелов. По этой причине, допиливают до более менее рабочего состояния аудиомоды именно под эти платформы.</p>

                    <p><h3>Процесс установки</h3></p>

                    <p>Принцип установки "NLSound" заключается в выборе нужных для пользователя пунктов. Каждый из пунктов несёт в себе часть скрипта установки. Сам модуль из себя представляет zip архив с базовым набором файлов для magisk и скриптом установки. При установке модуля происходит патчинг файлов с аудиоконфигурациями и создаётся папка с модулем в директории magisk-а, куда помещаются изменённые файлы, которые заменяют оригинальные системные при каждой перезагрузке смартфона. Присутствует автоустановка (ставит основные пункты), ручная и полная (ставит все пункты). В автоустановке присутствует отключение глубого буфера, IIR патчи, отключение компандеров, патчинг audio_platform файлов, патчинг mixer_paths файлов, улучшение внутреннего аудиокодека и патчинг device_features. Мы же же подробно рассмотрим ручную установку и каждый из её пунктов.</p>

                    <h4>Отключение глубокого буфера</h4>

                    <p>Deep Buffer - один из роутов используемых в Android, который задействуется в любой прошивке. На этом роуте низкие частоты немного жирнее и более размазаны. При его отключении низы станут не такими жирными, зато более чёткими и приближенными к оригиналу, т.к. отключается лишняя обработка. Изменения вносятся в system.prop файл.</p>

                    <h4>Увеличение уровней и шагов громкости медиа</h4>

                    <p>В директории /vendor/etc/ лежат файлы такого типа: mixer_paths.xml. Это одни из главных конфигурационных файлов, от настройки которых сильно зависит качество звука. В файлах этого типа имеются строки, отвечающие за уровни громкости на всех аудио выходах, кроме A2DP (Bluetooth). В этих файлах повышаются общие уровни громкости и в блоке "headphones". После применения данного пункта можно услышать ощутимую прибавку в громкости как динамика, так и проводных наушников.</p>

                    <h4>Увеличение громкости микрофонов</h4>

                    <p>Аналогично с предыдущим пунктом, только патчатся строки, относящиеся к микрофонам.</p>

                    <h4>IIR патчи</h4>

                    <p>IIR — линейный электронный фильтр, использующий один или более своих выходов в качестве входа, то есть образующий обратную связь. IIR является фильтром, накладываемым на АЧХ аналогового фильтра. Это позволяет избежать нежелательных частотных срезов фильтра, те самым исключив вероятность искажения сигнала на выходе. Этот пункт применяет настройки фильтра, отличные от стоковых, которые также находятся в mixer_paths файлах. В результате мы получаем расширение частотного диапазона и более ровную АЧХ.</p>

                    <h4>Патчинг audio_platform файлов</h4>

                    <p>В этих файлах находятся фиксации битности аудио. Применение данного пункта даёт фиксированные 24 бита на выход проводных наушников и динамиков. Также, при установке данного пункта изменения вносятся и в mixer_paths файлы, а именно фиксации частот дискретизации, улучшенные методы обработки звука и изменения форматов выводов аудио на конкретных аудиошинах. Все данные фиксации имеют очень сильное влияние на улучшение качества аудио.</p>

                    <h4>Отключение компандеров</h4>

                    <p>Компрессор + экспандер (mixer_paths файлы). Всё бы ничего, но настроить компандеры в Android-е невозможно, только включить или выключить. Во включенном состоянии компандер будет видоизменять звук, пока не исчезнут цифровые перегрузы, всё дальше отходя от оригинального звучания без возможности регулировать компрессор и экспандер. После отключения компандеров звук станет менее зажат, появится возможность слушать треки в качестве, приближённом к изначальному, без обработки. Также, вместе с компандерами в mixer_paths файлах отключается вся возможная компрессия на аудиовыходы.</p>

                    <h4>Настройка внутреннего аудио кодека</h4>

                    <p>В файле /vendor/etc/audio_configs.xml лежат основные конфигурации для встроенного аудиокодека. Этот файл имеется далеко не во всех прошивках, но при его наличии можно применить данный пункт и получить небольшое улучшение качества. Применяя этот пункт мы модифицируем конфиг, заменяя стоковые значения параметров на нужные, для настройки кодека на воспроизведение более качественного звука.</p>

                    <h4>Патчинг device_features файлов</h4>

                    <p>Актуально только для MIUI, т.к. это её собственная фишка, которой нет больше ни у какой другой прошивки. Сам файл лежит в /etc/device_features/ и нужен для включения различных полезных фич. Скрипт меняет булевые значения у строчек, а система выполняет то, что она считывает из файла. Включив данный пункт мы разблокируем частоты дискретизации вплоть до 192000 kHz, включим HD запись аудио, улучшим качество Voip записи, включим функцию Hi-Fi на поддерживаемых устройствах и многое другое.</p>

                    <h4>Добавление нового dirac</h4>

                    <p>Dirac — это аудиодвижок, и по мнению разработчиков NLSound самый адекватный среди всех. По крайней мере, не зря именно его использует Asus, Oppo и Xiaomi. Dirac включает в себя библиотеки с эффектами, бинарник, настройку своего интерфейса и набор пропов (строчек system.prop файла). Наличие в модуле аудиодвижка обуславливается тем, что чистый звук может показаться не таким красочным, а Dirac придаёт красок любому треку. Дирак взят со смартфона от Oppo и полноценно работает. Единственный минус - совместимость. Для устройств с MIUI этот дирак не подходит, т.к. будет конфликт со встроенным, а также, многие прошивки сами по себе с ним конфликтуют, но всё же попробовать стоит.</p>

                    <h4>Модификация mixer_paths файлов</h4>

                    <p>Один из самых проблемных, но эффективных пунктов. Применяет огромное колличество всевозможных улучшений для аудиовыходов, включает функцию HIFI, доступную на процессорах Qcom, начиная с Snapdragon 665 и выше, повышает уровень питания и вольтаж там, где это возможно, подключает алгоритмы усилитей, повышает качество обработки аудио и заставляет работать усилители на полную (усилители от TFA и TAS). Проблемы со звуком могут возникнуть из-за несовместимости некоторых параметров, поэтому методом пробы можно определить, стоит устанавливать данный пункт или нет.</p>

                    <h4>Установка твиков в system.prop файл</h4>

                    <p>В структуре модуля имеется файл system.prop. Через него можно менять значения строк из файлов build.prop и внесённые изменения будут применяться поверх системных. В этом файле содержаться строки, которые подключают всевозможные пропы, которые отвечают за звук. Применённые пропы повышают качество обработки звука аудиокодеками, подключают dsp-процессор где это возможно, приводят в должное состояние аудио эффекты, включают встроенные в систему оптимизации звука и улучшают качество записи аудио. Применение данного пункта рекомендуется, а разница в звучании будет слышна сразу.</p>

                    <h4>Улучшение Bluetooth</h4>

                    <p>Применяет оптимизации Bluetooth канала в system.prop и включает поддержку кодеков AAC и APTX где это возможно.</p>

                    <h4>Переключение роута звука с DIRECT на DIRECT_PCM</h4>

                    <p>DIRECT_PCM — этот роут может выводить звук в более высоком качестве, чем обычный DIRECT. Опять же, приближение звука к оригинальному виду, за счёт отключения лишней обработки. Замена роута производится в файле audio_io_policy.conf.</p>

                    <h4>Отключение DRC функции</h4>

                    <p>Бесполезная система защиты от перегрузов, которая ограничивает динамический диапазон аудио треков. Отключается в файле audio_policy_configuration.xml и в результате получаем более живой звук.</p>

                    <p><h3>Что в итоге?</h3></p>

                    <p>После установки модуля достаточно перезагрузить устройство, и наслаждаться полученным качеством звука. Но, есть и свои минусы. После установки возможено повышение потребления энергии, что отразится на разряде аккумулятора. Разница будет почти не ощутима, но такой минус присутствует. Также нарузка на процессор: она действительно станет выше. В играх вполне можно потерять кадров 5. Конечно, всё зависит от устройства, но такое случается. Также, при установке могут возникнуть проблемы с работоспособностью микрофона, основного и разговорного динамиков, наушников или Bluetooth. Для устранения возникших проблем придётся исключать проблемные пункты из установки. В большей части случаев, кроме повышения качества звучания смартфона, получить какие-либо проблемы маловероятно, а сломать что-то в принципе невозможно. Всё нужно пробовать и приходить к лучшему варианту. Существуют и другие модули, нацеленные на качество звучания, например тот же AINUR или AIST. Не стоит ограничиваться одним модулем, возможно, вам понравятся иные модификиации, но и устанавливать их вместе не рекомендуется, т.к. будут возникать конфликты в системе. Следующая статья будет посвящена объективному сравнению ряда аудиомодификаций, в которой вы узнаете ещё больше о мобильном звуке. Удачных прошивов без бутлупов!</p>

                </section>

            </main>

            <footer>

                <p>© 2022 Albert Kramar</p>
            
            </footer>

        </div>

        <script src="../../scripts/jquery.js" type="text/javascript"></script>
        <script src="../../scripts/script.js" type="text/javascript"></script>

    </body>

</html>

